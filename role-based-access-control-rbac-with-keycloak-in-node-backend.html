<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="Road to Dev Blog Posts">
    <title>Role-Based Access Control (RBAC) with Keycloak in Node Backend</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
    <link rel="stylesheet" type="text/css" href="https://julianrotti.github.io/theme/css/main.css" />
    <link rel="stylesheet" type="text/css" href="https://julianrotti.github.io/theme/css/pygment.css" />
    <link rel="shortcut icon" href="https://julianrotti.github.io/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://julianrotti.github.io/theme/css/stork.css">
    <link rel="stylesheet" media="screen and (prefers-color-scheme: dark)"
        href="https://julianrotti.github.io/theme/css/stork-dark.css">
    <link
        href="https://julianrotti.github.io/feeds/all.atom.xml"
        type="application/atom+xml" rel="alternate" title="Road to Dev Atom Feed" />
<meta name="description" content="Securing a Node.js backend with Keycloak such that only users with certain roles are allowed to make API calls." />
</head>

<body class="min-h-screen flex flex-col max-w-7xl lg:max-w-none text-zinc-800 bg-neutral-100 
    dark:bg-neutral-900 dark:text-zinc-300 container mx-auto justify-center md:px-3 ">
    <script>
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    <nav class="sm:flex sm:justify-between xl:ml-32 pl-4 items-center">
        <div class="flex pt-4">
            <h1 class="font-semibold text-2xl"><a href="https://julianrotti.github.io/">Road to Dev</a></h1>
            <button id="theme-toggle" type="button" aria-label="Light|Dark"
                class="text-zinc-700 dark:text-zinc-400 rounded-full focus:outline-none text-sm ml-2 p-1">
                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                        fill-rule="evenodd" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <ul class="flex flex-wrap lg:mr-24 md:pt-0">
            <li class="mr-4 pt-6"><a  href="https://julianrotti.github.io/archives.html">Archive</a></li>
            <li class="mr-4 pt-6"><a                     href="https://julianrotti.github.io/categories.html">Categories</a></li>
            <li class="mr-4 pt-6"><a  href="https://julianrotti.github.io/tags.html">Tags</a></li>
            <!--<li class="mr-4 pt-6"><a  href="https://julianrotti.github.io/search.html">Search</a></li>-->
        </ul>
    </nav>
    <div class="flex-grow md:max-w-screen-md md:mx-auto md:w-3/4 px-4">
        <nav class="text-zinc-800 dark:text-zinc-300 mt-12 pb-2 md:mt-16" aria-label="Breadcrumb">
            <ul class="p-0 inline-flex items-center">
                <li class="flex items-center">
                    <a href="https://julianrotti.github.io/" class="text-zinc-800 dark:text-zinc-300 inline-flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z">
                            </path>
                        </svg>
                        Home
                    </a>
                    <svg class="fill-current w-3 h-3 mr-2 ml-1" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 320 512">
                        <path
                            d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
                    </svg>
                </li>
                <li class="flex items-center">
                    <a href="https://julianrotti.github.io/categories.html">Categories</a>
                    <svg class="fill-current w-3 h-3 mr-2 ml-1" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 320 512">
                        <path
                            d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
                    </svg>
                </li>
                <li class="flex items-center">
                    <a href="https://julianrotti.github.io/category/web-development.html">web development</a>
                    <svg class="fill-current w-3 h-3 mr-2 ml-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                        <path
                            d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
                    </svg>
                </li>
            </ul>
        </nav>

<main>
  <header>
    <h1 class="font-semibold text-3xl my-2">Role-Based Access Control (RBAC) with Keycloak in Node Backend</h1>
    <footer class="flex text-sm text-zinc-800 dark:text-zinc-400">
      <div class="flex text-xs text-zinc-800 dark:text-zinc-400">
        <time>October 14, 2024</time>
        <div>
        </div>
        <div>
          <span>&nbsp;Â·&nbsp;Leon Ramzews</span>
        </div>
      </div>
    </footer>
  </header>
  <details class="flex flex-col my-6 p-4 bg-zinc-200 dark:bg-zinc-800 rounded-lg">
    <summary class="text-lg font-bold">Table of contents</summary>
    <div class="mx-4 px-4 underline">
      <div id="toc"><ul><li><a class="toc-href" href="#introduction" title="Introduction">Introduction</a></li><li><a class="toc-href" href="#setting-up-keycloak" title="Setting Up Keycloak">Setting Up Keycloak</a></li><li><a class="toc-href" href="#node-backend" title="Node Backend">Node Backend</a></li></ul></div>
    </div>
  </details>
  <div class="max-w-7xl container mx-auto my-8 text-zinc-800 dark:text-zinc-300  
              prose lg:max-w-none prose-headings:text-zinc-800 prose-headings:dark:text-zinc-300 
              prose-h1:text-3xl lg:prose-h1:text-3xl prose-headings:font-semibold 
              prose-pre:bg-zinc-200 prose-pre:text-zinc-800
              dark:prose-pre:bg-zinc-800 dark:prose-pre:text-zinc-200
              prose-blockquote:text-zinc-800
              dark:prose-blockquote:text-zinc-200
              prose-a:text-slate-600 prose-a:font-normal
              dark:prose-a:text-slate-400
              dark:prose-strong:text-zinc-200 
              dark:prose-code:text-zinc-200
              dark:prose-code:bg-zinc-800
              prose-code:bg-zinc-200
              prose-code:font-light
              prose-img:rounded-md
              sm:text-left md:text-justify
              ">
    <h2 id="introduction">Introduction</h2>
<p>In this blog post, I&rsquo;ll walk you through how to:</p>
<ul>
<li>Set up Keycloak, from installation to configuration,  </li>
<li>Secure a simple Node.js backend by protecting API endpoints using Keycloak authentication,  </li>
<li>Implement role-based access control (RBAC), ensuring only users with appropriate roles can access certain API routes,  </li>
<li>Create simple frontend buttons that pass the Keycloak token to the backend based on the currently logged-in user.  </li>
</ul>
<p>A minimal working example is available here: <a href="https://github.com/JulianRotti/keycloak-sample-project">https://github.com/JulianRotti/keycloak-sample-project</a>. Make sure to choose the <code>backend-integration</code> branch for both the main project <code>keycloak-sample-project</code> and its submodules <code>keycloak-react</code> and <code>keycloak-node</code>.</p>
<hr/>
<h2 id="setting-up-keycloak">Setting Up Keycloak</h2>
<h3>Installing Keycloak with Docker</h3>
<p>To get Keycloak running quickly, I set it up using Docker. Below is the <code>docker-compose.yml</code> file I used to manage the Keycloak instance:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keycloak</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/keycloak/keycloak:25.0.6</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keycloak</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KEYCLOAK_ADMIN=admin</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KEYCLOAK_ADMIN_PASSWORD=admin</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"8080:8080"</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start-dev</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keycloak_data:/opt/keycloak/data</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keycloak_data</span><span class="p">:</span>
</code></pre></div>
<h4>Key Points:</h4>
<ul>
<li><strong>Image</strong>: I used the <code>25.0.6</code> version of the Keycloak image from quay.io.</li>
<li><strong>Admin Credentials</strong>: Set to <code>admin/admin</code> for quick local setup.</li>
<li><strong>Volumes</strong>: Persistent data storage for Keycloak is handled using Docker volumes.</li>
</ul>
<p>After setting this up, I ran <code>docker-compose up</code> to make Keycloak accessible at <a href="http://localhost:8080">http://localhost:8080</a>.</p>
<h3>Configuring Keycloak</h3>
<ol>
<li><strong>Creating a Realm</strong>: I created a new realm called <code>my-website</code>&mdash;an isolated space to manage users, roles, and clients.</li>
<li><strong>Defining Roles</strong>: <ul>
<li><code>viewer</code> </li>
<li><code>editor</code> </li>
</ul>
</li>
<li><strong>Creating Users</strong>:<ul>
<li><code>test_viewer</code> (assigned the <code>viewer</code> role)  </li>
<li><code>test_editor</code> (assigned <strong>both</strong> the <code>editor</code> and <code>viewer</code> roles for easier testing and role management)  </li>
</ul>
</li>
<li><strong>Setting Up Clients</strong>:<ul>
<li><strong>Frontend Client</strong>: <ul>
<li>Client ID: <code>my-website-frontend</code> </li>
<li>Root URL: <code>http://localhost:3000</code> </li>
<li>Web Origins: <code>http://localhost:3000</code> </li>
<li>Redirect URIs: <code>http://localhost:3000/*</code> </li>
</ul>
</li>
<li><strong>Backend Client</strong>:<ul>
<li>Client ID: <code>my-website-backend</code> </li>
<li>Turned <strong>Client Authentication</strong> on for secure token verification.  </li>
</ul>
</li>
</ul>
</li>
</ol>
<hr/>
<h2 id="node-backend">Node Backend</h2>
<h3>Node Backend Structure with Keycloak RBAC</h3>
<p>For the backend, I structured the project using best practices by organizing the code into specific layers. This allows for cleaner and more maintainable code. Here's a breakdown of the folder structure:</p>
<div class="highlight"><pre><span></span><code>src/
&boxvr;&boxh;&boxh; models/
&boxvr;&boxh;&boxh; services/
&boxvr;&boxh;&boxh; middleware/
&boxvr;&boxh;&boxh; controllers/
&boxvr;&boxh;&boxh; routes/
</code></pre></div>
<ul>
<li><strong>models/</strong>: Contains data models for our backend. In this case, since we're using mock data, I used classes and singleton patterns to simulate database behavior.  </li>
<li><strong>services/</strong>: Handles business logic and mock data interaction. This layer is responsible for manipulating the data provided by the models.  </li>
<li><strong>middleware/</strong>: Contains middleware for request handling, including Keycloak authentication.  </li>
<li><strong>controllers/</strong>: Responsible for handling the logic related to specific API routes (e.g., fetching or posting data).  </li>
<li><strong>routes/</strong>: Defines the application's API endpoints and connects them to the appropriate controller and middleware functions.  </li>
</ul>
<hr/>
<h3>Keycloak Middleware</h3>
<p>The next step was setting up Keycloak middleware for authentication and RBAC. I used a combination of <code>axios</code> and <code>jose</code> for this as the adapter <code>keycloak-connect</code> is deprecated. The middleware is configured in <code>middleware/authMiddleware.js</code> and the validation logic is implemented in <code>middleware/validationMiddleware.js</code>.</p>
<h4>Token and Public Key Extraction</h4>
<p>In <code>authMiddleware.js</code>, the logic to extract the token from incoming requests and to extract the public key from the Keycloak instance is implemented. These two steps are essential to verify whether the token in the request is legitimate&mdash;i.e., whether its signature matches the public key.</p>
<p>The configuration for Keycloak is stored in an <code>.env</code> file in the root directory. This allows for easy customization of the Keycloak URL, realm, and client ID.</p>
<p>To handle HTTP requests, <code>axios</code> is used for fetching the JWKS (JSON Web Key Set) URL from the Keycloak server. <code>jose</code> is used for handling JWTs (JSON Web Tokens), specifically for verifying token signatures.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'axios'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createRemoteJWKSet</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'jose'</span><span class="p">;</span>
</code></pre></div>
<p>Using <code>axios</code>, we fetch the JWKS URL, which contains the public keys needed to verify tokens issued by Keycloak.</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getJwksUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">keycloakUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">realm</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">wellKnownUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">keycloakUrl</span><span class="si">}</span><span class="sb">/realms/</span><span class="si">${</span><span class="nx">realm</span><span class="si">}</span><span class="sb">/.well-known/openid-configuration`</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">wellKnownUrl</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">jwks_uri</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>Next, the JWKS (a set of public keys) is fetched from the provided URL. The JWKS is crucial for validating the token's signature.</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Fetch and prepare the JWKS for token validation</span>
<span class="cm"> * @param {string} jwksUri - The URI of the JWKS</span>
<span class="cm"> * @returns {object} - A Remote JWK Set object for token validation</span>
<span class="cm"> */</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getJwks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">jwksUri</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">jwksUri</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">jwks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">createRemoteJWKSet</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="nx">jwksUri</span><span class="p">));</span><span class="w"> </span><span class="c1">// Return a Remote JWK Set object for token validation</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to fetch JWKS: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>Finally, a helper function is created to extract the bearer token issued by Keycloak from the <code>Authorization</code> header of the incoming request.</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">extractBearerToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">authHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'authorization'</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">authHeader</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">authHeader</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'Bearer '</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">authHeader</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[</span><span class="mf">1</span><span class="p">];</span><span class="w"> </span><span class="c1">// Extract and return the token</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Authorization token is missing or invalid.'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4>Validating the Token and Role</h4>
<p>In <code>validationMiddleware.js</code>, the extracted bearer token is validated. The <code>jwtVerify</code> function from <code>jose</code> is used, along with the helper functions defined in <code>authMiddleware.js</code>. The environment variables are also accessed using <code>dotenv</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">jwtVerify</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'jose'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getJwksUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">getJwks</span><span class="p">,</span><span class="w"> </span><span class="nx">extractBearerToken</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'./authMiddleware.js'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">dotenv</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'dotenv'</span><span class="p">;</span>

<span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">keycloakUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_APP_KEYCLOAK_URL</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_APP_KEYCLOAK_REALM</span><span class="p">;</span>
</code></pre></div>
<p>To validate whether the bearer token has a valid signature, the token and the JWKS are passed into <code>jwtVerify</code>. If the token is valid, the payload (which contains user information, including roles) is saved in <code>req.user</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">validateToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extractBearerToken</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">jwksUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getJwksUrl</span><span class="p">(</span><span class="nx">keycloakUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">realm</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">jwks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getJwks</span><span class="p">(</span><span class="nx">jwksUri</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">jwtVerify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">jwks</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">issuer</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">keycloakUrl</span><span class="si">}</span><span class="sb">/realms/</span><span class="si">${</span><span class="nx">realm</span><span class="si">}</span><span class="sb">`</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">payload</span><span class="p">;</span><span class="w"> </span>
<span class="w">        </span><span class="nx">next</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Unauthorized: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>After successful token validation, the user's role is stored in <code>req.user</code> and can be checked against the required role. This ensures that only users with the appropriate role can access protected routes.</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">validateRole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">requiredRole</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">realm_access</span><span class="o">?</span><span class="p">.</span><span class="nx">roles</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">roles</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">requiredRole</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Missing required role: </span><span class="si">${</span><span class="nx">requiredRole</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">next</span><span class="p">();</span><span class="w"> </span><span class="c1">// Role is valid, proceed</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Forbidden: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<p>For simplicity, I combined token and role validation into a single function.</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">validateTokenAndRole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">requiredRole</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">validateToken</span><span class="p">,</span><span class="w"> </span><span class="nx">validateRole</span><span class="p">(</span><span class="nx">requiredRole</span><span class="p">)];</span>
<span class="p">}</span>
</code></pre></div>
<h3>Protecting API Routes with RBAC</h3>
<p>In the <code>routes/AppRoutes.js</code> file, we define our API routes and apply role-based protection. In this example, only users with the <code>viewer</code> role can access the <code>get-data</code> endpoint.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'express'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validateTokenAndRole</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../middleware/validationMiddleware.js'</span><span class="p">;</span>
<span class="c1">// Add your controller import here (e.g., appController)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/get-data/:id'</span><span class="p">,</span><span class="w"> </span><span class="nx">validateTokenAndRole</span><span class="p">(</span><span class="s1">'viewer'</span><span class="p">),</span><span class="w"> </span><span class="nx">appController</span><span class="p">.</span><span class="nx">getDataById</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</code></pre></div>
<p>In this setup, if a user tries to access the <code>/get-data/:id</code> route without the appropriate role (<code>viewer</code> in this case), they will receive a "Forbidden" error.</p>
<blockquote>
<p><strong>Note</strong>: This is all we need to do in order to integrate Keycloak into the backend for role-based access control. To test this, I will now complete the remaining code to provide the models, services, controllers, and routes, which can be used to fetch data and test role-based protection in practice.</p>
</blockquote>
<h3>Sample Node Backend</h3>
<p>The following sections describe the layered structure of the Node backend, using role-based access control (RBAC) with Keycloak. Each layer of the application is structured to maintain a clean separation of concerns and ensure scalability, maintainability, and security.</p>
<h4>Models</h4>
<p>The <strong>models</strong> layer mimics a database model structure, similar to how you would use something like Sequelize for interacting with a SQL database. In this example, we mock the behavior of a database with in-memory data to simulate how models would interact with an actual database.</p>
<p>Here's how it works:</p>
<ul>
<li><code>MockDataModel</code>: Represents a basic data model with <code>id</code> and <code>name</code> properties.  </li>
<li><code>DataBaseModel</code>: Mimics the behavior of a database with methods to create and retrieve data. It implements the <strong>singleton pattern</strong> to ensure only one instance of the database exists.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/models/MockDataModel.js</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// mimic the behaviour of sequelize</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">DataBaseModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do not create a new instance if there is already one (singleton pattern)</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">mockDataStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">DataBaseModel</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">mockDataStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mockDataStore</span><span class="p">;</span>
<span class="w">          </span><span class="nx">DataBaseModel</span><span class="p">.</span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">DataBaseModel</span><span class="p">.</span><span class="nx">instance</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">    </span><span class="nx">create</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">maxId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="k">this</span><span class="p">.</span><span class="nx">mockDataStore</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">newData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">mockDataStore</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newData</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">newData</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mockDataStore</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mockDataStore</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4>Services</h4>
<p>The <strong>services</strong> layer handles the direct interaction with the data. In a real-world scenario, this layer would communicate with a database, making queries and returning the results. In our case, we define mock data and simulate these interactions by manipulating the in-memory data.</p>
<p>Here's how it works:</p>
<ul>
<li><code>getDataById</code>: Takes an ID, parses it, and returns the corresponding data from the mock database.  </li>
<li><code>getAllData</code>: Retrieves all the mock data.  </li>
<li><code>createData</code>: Adds new data to the mock database.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/services/MockDataService.js</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="p">,</span><span class="w"> </span><span class="nx">DataBaseModel</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"../models/MockDataModel.js"</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mockData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'Mario'</span><span class="p">),</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">'Wario'</span><span class="p">),</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">'Peach'</span><span class="p">),</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">MockDataModel</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">'Luigi'</span><span class="p">)</span>
<span class="p">];</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">dataBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DataBaseModel</span><span class="p">(</span><span class="nx">mockData</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getDataById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">parsedId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">dataBase</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">parsedId</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getAllData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">dataBase</span><span class="p">.</span><span class="nx">findAll</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">dataBase</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4>Controllers</h4>
<p>The <strong>controllers</strong> layer defines the logic for handling API requests. Each controller function corresponds to an API endpoint and is responsible for receiving requests, interacting with services, and returning appropriate responses. Controllers act as the intermediary between the routes and services.</p>
<p>Here's how it works:</p>
<ul>
<li><code>getDataById</code>: Handles GET requests for retrieving specific data by ID.  </li>
<li><code>getAllData</code>: Handles GET requests to return all available data.  </li>
<li><code>postData</code>: Handles POST requests for adding new data.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/controllers/AppController.js</span>

<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">mockDataService</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"../services/MockDataService.js"</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getDataById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mockDataService</span><span class="p">.</span><span class="nx">getDataById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">'Data not found.'</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Failed to get data by id: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getAllData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">allData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mockDataService</span><span class="p">.</span><span class="nx">getAllData</span><span class="p">();</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">allData</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Failed to get all data: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">postData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">newData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mockDataService</span><span class="p">.</span><span class="nx">createData</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">201</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">newData</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="sb">`Failed to create data: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4>Routes</h4>
<p>The <strong>routes</strong> layer combines all the pieces together, defining how the application's endpoints are structured and which roles are allowed to access them. This is where role-based access control (RBAC) is enforced using Keycloak.</p>
<p>Here's how it works:</p>
<ul>
<li>The routes use <code>protectWithRole</code> to restrict access based on user roles. Only users with the appropriate roles (e.g., <code>viewer</code>, <code>editor</code>) can access specific endpoints.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/routes/AppRoutes.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'express'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">appController</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../controllers/AppController.js'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">protectWithRole</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../middleware/authMiddleware.js'</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/get-data/:id'</span><span class="p">,</span><span class="w"> </span><span class="nx">protectWithRole</span><span class="p">(</span><span class="s1">'viewer'</span><span class="p">),</span><span class="w"> </span><span class="nx">appController</span><span class="p">.</span><span class="nx">getDataById</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/get-data'</span><span class="p">,</span><span class="w"> </span><span class="nx">protectWithRole</span><span class="p">(</span><span class="s1">'viewer'</span><span class="p">),</span><span class="w"> </span><span class="nx">appController</span><span class="p">.</span><span class="nx">getAllData</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/post-data'</span><span class="p">,</span><span class="w"> </span><span class="nx">protectWithRole</span><span class="p">(</span><span class="s1">'editor'</span><span class="p">),</span><span class="w"> </span><span class="nx">appController</span><span class="p">.</span><span class="nx">postData</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</code></pre></div>
<h4>Index.js</h4>
<p>In the <strong>index.js</strong> file, we initialize the express server and set up middleware for Keycloak and CORS. <strong>CORS</strong> is important for handling cross-origin requests from the frontend, especially when the frontend and backend are hosted on different ports or domains.</p>
<p>Here's how it works:
- <strong>Keycloak middleware</strong> is initialized globally, enabling the entire app to be protected by Keycloak RBAC.
- <strong>CORS</strong> is enabled to allow requests from the React frontend hosted on <code>http://localhost:3000</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/index.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'express'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">AppRoutes</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'./routes/AppRoutes.js'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'cors'</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>

<span class="c1">// Middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="c1">// Enable CORS for requests from http://localhost:3000 (React frontend)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">({</span>
<span class="w">    </span><span class="nx">origin</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://localhost:3000'</span><span class="p">,</span>
<span class="p">}));</span>

<span class="c1">// Routes</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/api'</span><span class="p">,</span><span class="w"> </span><span class="nx">AppRoutes</span><span class="p">);</span>

<span class="c1">// Start the server</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">5000</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server is running on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h3>Testing with Curl</h3>
<p>To test the role-based access control (RBAC) protected API, you first need to obtain an access token from Keycloak and use it to make requests to your API. For this, Keycloak and the Node.js backend should be up and running via <code>npm start</code>.</p>
<h4>Step 1: Get Access Token</h4>
<p>To retrieve an access token for the user <code>test_editor</code>, run the following <code>curl</code> command. This will authenticate the user and return the access token, which you can use to make authorized API requests.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s1">'http://localhost:8080/realms/my-website/protocol/openid-connect/token'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/x-www-form-urlencoded'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">'client_id=my-website-frontend'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">'grant_type=password'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">'username=test_editor'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">'password=test'</span>
</code></pre></div>
<p>This command returns a JSON response containing the access token (<code>access_token</code>). You will use this token to authenticate requests to the Node.js API.</p>
<h4>Step 2: Make Curl Requests to the API</h4>
<p>Now, use the obtained access token to make requests to the API.</p>
<ol>
<li><strong>Get All Data</strong> (requires the <code>viewer</code> role):</li>
</ol>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s1">'http://localhost:5000/api/get-data'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">'Authorization: Bearer &lt;ACCESS_TOKEN&gt;'</span>
</code></pre></div>
<ol>
<li><strong>Get Data by ID</strong> (requires the <code>viewer</code> role):</li>
</ol>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s1">'http://localhost:5000/api/get-data/1'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">'Authorization: Bearer &lt;ACCESS_TOKEN&gt;'</span>
</code></pre></div>
<ol>
<li><strong>Post New Data</strong> (requires the <code>editor</code> role):</li>
</ol>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s1">'http://localhost:5000/api/post-data'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">'Authorization: Bearer &lt;ACCESS_TOKEN&gt;'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">'{"name": "Yoshi"}'</span>
</code></pre></div>
<p>Replace <code>&lt;ACCESS_TOKEN&gt;</code> with the token you obtained in Step 1. Each request is authenticated, and depending on the role assigned to the user, access to the endpoints will either succeed or fail.</p>
<hr/>
<h3>Integration with a React Frontend</h3>
<p>In the next step, I integrated the React frontend with the backend from my previous blog post. The idea is to use Keycloak for both frontend and backend RBAC, ensuring secure data access for users based on their roles.</p>
<p>To achieve this, I added:</p>
<ul>
<li><strong>services/api.js</strong>: Provides functions to call the backend API and pass the Keycloak token of the logged-in user.  </li>
<li><strong>components/ApiButtons.js</strong>: Buttons that call these API functions when clicked.  </li>
<li><strong>pages/HomePage.js</strong>: A page where these buttons are available, making RBAC testing easier.  </li>
</ul>
<p>This setup (along with the already implemented login/logout button) offers a simple way to test RBAC functionality from frontend to backend.</p>
<h4>Services</h4>
<h3><code>keycloak.js</code></h3>
<p>In this file, I added a utility function, <code>getAccessToken</code>, to retrieve the Keycloak access token for the currently authenticated user. This token is critical when making secure API calls from the frontend to the backend. It ensures that the requests are properly authenticated and authorized.</p>
<p>Here's how it works:</p>
<ul>
<li><code>getAccessToken</code>: This function checks if the user is authenticated with Keycloak. If the user is authenticated, it retrieves and returns the access token. This token is then used in the <code>Api.js</code> service functions (e.g., <code>getAllData</code>, <code>postData</code>) to authorize API calls to the backend.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/services/keycloak.js</span>

<span class="c1">// Function to get the access token of the current authenticated user</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getAccessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">keycloak</span><span class="p">.</span><span class="nx">authenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">keycloak</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span><span class="w"> </span><span class="c1">// Return the access token</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'User is not authenticated.'</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Or handle it according to your needs</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>By calling <code>getAccessToken</code> inside the button components (e.g., <code>GetAllDataButton</code>), we can ensure that only authenticated users are able to make authorized requests to the backend. If the user is not authenticated, the function will return <code>null</code>, and an error message can be displayed accordingly.</p>
<h5><code>api.js</code></h5>
<p>The <code>services/api.js</code> file contains functions for making HTTP requests to the backend API with the user's access token.</p>
<p>Here's how it works:</p>
<ul>
<li><code>getAllData</code>: Fetches all data from the backend.  </li>
<li><code>getDataById</code>: Fetches data by ID.  </li>
<li><code>postData</code>: Sends new data to the backend.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/services/api.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'axios'</span><span class="p">;</span>

<span class="c1">// Base URL for the API</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'http://localhost:5000/api'</span><span class="p">;</span><span class="w"> </span><span class="c1">// Adjust this if necessary</span>

<span class="c1">// Function to get all data</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getAllData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">BASE_URL</span><span class="si">}</span><span class="sb">/get-data`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">accessToken</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Error fetching all data:'</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Function to get data by ID</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getDataById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">accessToken</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">BASE_URL</span><span class="si">}</span><span class="sb">/get-data/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">accessToken</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error fetching data by ID </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Function to post new data</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">postData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">accessToken</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">BASE_URL</span><span class="si">}</span><span class="sb">/post-data`</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">accessToken</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Error posting data:'</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4>Components</h4>
<p>In the <code>components/ApiButtons.js</code> file, buttons are defined to trigger API requests from the frontend when clicked. These buttons use the <code>getAccessToken</code> function to retrieve the current user's access token, which is passed to the backend to authenticate and authorize the request. The token is verified on the backend to ensure that the user has the appropriate permissions (based on roles) to access the data.</p>
<p>Here's how it works:</p>
<ul>
<li><code>GetAllDataButton</code>: Retrieves the access token using <code>getAccessToken</code>, calls the <code>getAllData</code> function with the token, and displays the data returned by the backend.  </li>
<li><code>GetDataByIdButton</code>: Uses the access token to call the <code>getDataById</code> function with a specific ID and displays the corresponding data.  </li>
<li><code>PostDataButton</code>: Sends new data to the backend using the <code>postData</code> function, along with the access token to authorize the request.  </li>
</ul>
<p>This approach ensures that only authenticated users with the proper roles can interact with these API endpoints.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/components/ApiButtons.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useContext</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getAccessToken</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../services/keycloak.js'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AuthContext</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../contexts/AuthContext.js'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getAllData</span><span class="p">,</span><span class="w"> </span><span class="nx">getDataById</span><span class="p">,</span><span class="w"> </span><span class="nx">postData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../services/api.js'</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">GetAllDataButton</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isAuthenticated</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">AuthContext</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleButtonClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isAuthenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getAccessToken</span><span class="p">();</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getAllData</span><span class="p">(</span><span class="nx">accessToken</span><span class="p">);</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span><span class="w">  </span><span class="c1">// Use JSON.stringify for better alert visibility</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Error fetching data: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"You need to be logged in to access this data."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleButtonClick</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="nx">Get</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">data</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">GetDataByIdButton</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isAuthenticated</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">AuthContext</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Example ID</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleButtonClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isAuthenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getAccessToken</span><span class="p">();</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getDataById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">accessToken</span><span class="p">);</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Error fetching data: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"You need to be logged in to access this data."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleButtonClick</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="nx">Get</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">{</span><span class="nx">id</span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">PostDataButton</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isAuthenticated</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useContext</span><span class="p">(</span><span class="nx">AuthContext</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"name"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Heiko"</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleButtonClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isAuthenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getAccessToken</span><span class="p">();</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">postData</span><span class="p">(</span><span class="nx">newData</span><span class="p">,</span><span class="w"> </span><span class="nx">accessToken</span><span class="p">);</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Data posted successfully!"</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Error posting data: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"You need to be logged in to post data."</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleButtonClick</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">                </span><span class="nx">Post</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">{</span><span class="nx">newData</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4>Pages</h4>
<p>The <code>pages/HomePage.js</code> file contains the homepage with buttons to interact with the backend and test RBAC.</p>
<p>Here's how it works:</p>
<ul>
<li>All the buttons are rendered on this page.  </li>
<li>Users can log in and click the buttons to see how RBAC works based on their roles.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// src/pages/HomePage.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GetAllDataButton</span><span class="p">,</span><span class="w"> </span><span class="nx">GetDataByIdButton</span><span class="p">,</span><span class="w"> </span><span class="nx">PostDataButton</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../components/ApiButtons.js'</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">HomePage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">This</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">accessible</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">everyone</span><span class="w"> </span><span class="p">(</span><span class="nx">including</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">authenticated</span><span class="w"> </span><span class="nx">users</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">GetAllDataButton</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">GetDataByIdButton</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">PostDataButton</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">HomePage</span><span class="p">;</span>
</code></pre></div>
<h4>Testing the Integration</h4>
<p>To test the integration of Keycloak, backend, and frontend:</p>
<ol>
<li>Ensure all services (Keycloak, backend, and frontend) are running via <code>npm start</code>.  </li>
<li>Log in as a user in the frontend (e.g., <code>test_editor</code>), and try accessing the different buttons.  </li>
<li>The buttons will perform API calls to the backend with the Keycloak access token, and the responses will depend on the user's roles.</li>
<li>Users with the <code>viewer</code> role can get data.  </li>
<li>Users with the <code>editor</code> role can post data.  </li>
</ol>
    <!-- <div class="aspect-w-16 aspect-h-9 mx-auto"></div> CSS placeholder -->
  </div>
  <footer class="flex flex-col mt-10 ">
    <ul class="flex flex-wrap">
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="https://julianrotti.github.io/tag/keycloak.html">keycloak</a>
        </li>
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="https://julianrotti.github.io/tag/keycloak-connect.html">keycloak-connect</a>
        </li>
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="https://julianrotti.github.io/tag/node.html">node</a>
        </li>
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="https://julianrotti.github.io/tag/rbac.html">rbac</a>
        </li>
    </ul>
    <div class="flex w-full my-2 bg-zinc-200 dark:bg-zinc-700 rounded-lg">
      <div class="w-1/2 rounded-l-lg"></div>
    </div>
    <div class="flex bg-zinc-200 dark:bg-zinc-700 py-2 rounded-lg justify-center space-x-2 text-xs">
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="twitter" aria-label="share Features on twitter"
            href="https://twitter.com/intent/tweet/?text=Features&amp;url=https://julianrotti.github.io/role-based-access-control-rbac-with-keycloak-in-node-backend.html">
            <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="linkedin" aria-label="share Features on linkedin"
            href="https://www.linkedin.com/sharing/share-offsite/?url=https://julianrotti.github.io/role-based-access-control-rbac-with-keycloak-in-node-backend.html">
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="reddit" aria-label="share Features on reddit"
            href="https://reddit.com/submit?url=https://julianrotti.github.io/role-based-access-control-rbac-with-keycloak-in-node-backend.html">
            <i class="fab fa-reddit fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="facebook" aria-label="share Features on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https://julianrotti.github.io/role-based-access-control-rbac-with-keycloak-in-node-backend.html">
            <i class="fab fa-facebook fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="whatsapp" aria-label="share Features on whatsapp"
            href="https://api.whatsapp.com/send?text=Features - https://julianrotti.github.io/role-based-access-control-rbac-with-keycloak-in-node-backend.html">
            <i class="fab fa-whatsapp fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="telegram" aria-label="share Features on telegram"
            href="https://telegram.me/share/url?text=Features&amp;url=https://julianrotti.github.io/role-based-access-control-rbac-with-keycloak-in-node-backend.html">
            <i class="fab fa-telegram fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
    </div>
  </footer>
  <div>
  </div>
</main>

    </div>
    <footer class="flex w-full text-xs justify-center mt-10 mb-6 text-zinc-600 dark:text-zinc-400">
        <div class="px-4">
            <span>Â©2024&nbsp;&#8226;&nbsp;</span>Powered by
            <a class="underline" href="https://getpelican.com/">Pelican</a>&nbsp;&
            <a class="underline" href="https://github.com/aleylara/Papyrus">Papyrus</a>
        </div>
    </footer>


    <script>
        let themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        let themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            themeToggleLightIcon.classList.remove('hidden');
        } else {
            themeToggleDarkIcon.classList.remove('hidden');
        }
        let themeToggleBtn = document.getElementById('theme-toggle');
        themeToggleBtn.addEventListener('click', function () {
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });
    </script>
</body>

</html>